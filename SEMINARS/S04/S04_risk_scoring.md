    

# S04 - Приоритизация рисков L×I

## Таблица приоритизации

| Risk ID | Source (DFD/Row)                 | Consolidated Description                                                                        | Threat | NFR link         | L | Rationale-L                                                                                                 | I | Rationale-I                                                                                                              | Score | Decision | ADR candidate            |
| ------- | -------------------------------- | ----------------------------------------------------------------------------------------------- | ------ | ---------------- | - | ----------------------------------------------------------------------------------------------------------- | - | ------------------------------------------------------------------------------------------------------------------------ | ----- | -------- | ------------------------ |
| R-01    | Store Service → PostgreSQL      | SQL injection через динамические запросы к БД                        | T      | NFR-010          | 4 | Типовая уязвимость, публичное API, сложные фильтры каталога | 5 | Полный доступ к БД, утечка всех PII, компрометация заказов                  | 20    | Top-1    | SQL Injection Protection |
| R-02    | Клиент → Auth Service     | Утечка учетных данных и подбор паролей                         | S      | NFR-003          | 4 | Публичный эндпоинт, частые атаки брутфорса                             | 5 | Полный доступ к аккаунту, компрометация всех данных пользователя | 20    | Top-2    | Auth Hardening           |
| R-03    | Store Service → Payment Gateway | Утечка платежных данных и компрометация транзакций | I      | NFR-010, NFR-008 | 3 | Сложная интеграция, внешние зависимости                                  | 5 | Финансовые потери, регуляторные штрафы, репутационный ущерб          | 15    | Top-3    | Payment Security         |
| R-04    | Клиент → API Gateway      | Утечка PII через ответы API                                                    | I      | NFR-006          | 4 | Множество эндпоинтов, сложная бизнес-логика                           | 4 | Массовая утечка персональных данных, нарушение GDPR                             | 16    | Top-4    | PII Protection           |
| R-05    | Store Service → Warehouse API   | Отказ обслуживания из-за зависания внешних вызовов  | D      | NFR-008, NFR-007 | 3 | Внешние зависимости, сетевые проблемы                                      | 4 | Простой магазина, потеря продаж, корзины                                               | 12    | Top-5    | Resilience Patterns      |
| R-06    | API Gateway → Store Service     | Отсутствие сервисной аутентификации                            | S      | NFR-003          | 3 | Внутренняя сеть, но критичный трафик                                         | 4 | Компрометация бизнес-логики, подмена команд                                        | 12    | -        | Service-to-Service Auth  |
| R-07    | Auth Service                     | Утечка секретов JWT                                                               | I      | NFR-004          | 2 | Защищенная среда, но человеческий фактор                                 | 5 | Полная компрометация системы аутентификации                                      | 10    | -        | Secrets Management       |
| R-08    | Клиент → Auth Service     | DoS на эндпоинты аутентификации                                        | D      | NFR-007          | 3 | Публичный эндпоинт, известные векторы атак                             | 3 | Блокировка входа пользователей, но есть кэш JWT                                     | 9     | -        | Auth DoS Protection      |
| R-09    | Store Service → PostgreSQL      | PII в открытом виде в БД                                                        | I      | NFR-006          | 2 | Локальный доступ, но риски бэкапов                                             | 4 | Утечка при компрометации БД                                                                      | 8     | -        | Database Encryption      |
| R-10    | Клиент → Auth Service     | Утечка stacktrace в ошибках                                                       | I      | NFR-009          | 3 | Ошибки в продакшене, дебаг-режим                                                 | 2 | Информация для атакующего, но без прямых данных                                  | 6     | -        | Error Handling           |

## Top-5

**Top-1: R-01 - SQL Injection Protection**
Score: 20 (L4×I5)
Причина: Высокая вероятность из-за сложных фильтров каталога, критичное воздействие - полный доступ к БД
ADR candidate: Параметризованные запросы, ORM с экранированием, WAF

**Top-2: R-02 - Auth Hardening**
Score: 20 (L4×I5)
Причина: Частые атаки на публичные эндпоинты, компрометация всех пользовательских данных
ADR candidate: MFA, rate-limiting, сложная политика паролей

**Top-3: R-03 - Payment Security**
Score: 15 (L3×I5)
Причина: Внешние зависимости, но критичное воздействие - финансовые и регуляторные последствия
ADR candidate: Токенизация платежей, PCI DSS compliance, аудит транзакций

**Top-4: R-04 - PII Protection**
Score: 16 (L4×I4)
Причина: Множество точек утечки, массовое воздействие на пользователей
ADR candidate: Маскирование PII, data classification, access controls

**Top-5: R-05 - Resilience Patterns**
Score: 12 (L3×I4)
Причина: Зависимость от внешних API, бизнес-воздействие - простой магазина
ADR candidate: Circuit breaker, retry policies, graceful degradation
